# Generated by `rjournal_pdf_article()` using `knitr::purl()`: do not edit by hand
# Please edit IVHet.Rmd to modify this file

## ----tenure-data, message = FALSE---------------------------------------------
tenure_data <- read.csv(file = 'tenure.csv')


## ----logit--------------------------------------------------------------------
sub_data <- subset(tenure_data, year <= 10)
logit_m <- glm(tenure ~  year + I(year^2) + select + articles + prestige, 
               subset = (female == 0),
               data   = sub_data,
               family = binomial(link = "logit"))
logit_w <- glm(tenure ~  year + I(year^2) + select + articles + prestige, 
               subset = (female == 1), 
               data   = sub_data, 
               family = binomial(link = "logit"))


## ----table-logit, message = FALSE, warning=FALSE------------------------------
library("memisc")
mtable("Logit for men" = logit_m,
       "Logit for women" = logit_w, 
       summary.stats = c("Log-likelihood", "AIC", "BIC", "N"))


## ----het.logit, message = FALSE-----------------------------------------------
library("Rchoice")
het_logit <- hetprob(tenure ~ factor(female) + year + I(year^2) + select +  
                       articles + prestige | factor(female), 
                     data = sub_data, 
                     link = "logit")


## ----sum.het.logit------------------------------------------------------------
summary(het_logit)


## ----hetglm-------------------------------------------------------------------
library("glmx")
het_glmx <- hetglm(tenure ~ factor(female) + year + I(year^2) + select +  
                       articles + prestige | factor(female), 
                     data = sub_data, 
                    family = binomial(link = "logit"))
summary(het_glmx)


## ----table-het1---------------------------------------------------------------
mtable("Logit for men"   = logit_m,
       "Logit for women" = logit_w, 
       "Heteroskedastic" = het_logit,
       summary.stats = c("Log-likelihood", "AIC", "BIC", "N"))


## ----allinson-delta-----------------------------------------------------------
sigma_w <- exp(coef(het_logit)["het.factor(female)1"])
(1 -  sigma_w) / sigma_w


## ----allinson-delta-ci, message = FALSE---------------------------------------
library("car")
sharef <- "(1 - exp(`het.factor(female)1`)) / exp(`het.factor(female)1`)"
deltaMethod(het_logit, sharef)


## ----interaction--------------------------------------------------------------
het_logit2 <- hetprob(tenure ~ factor(female) + year + I(year^2) + select +  
                        articles + prestige + factor(female)*articles | 
                        factor(female), 
                      data = sub_data, 
                      link = "logit")
print(summary(het_logit2), digits = 3)


## ----plothet, fig.cap = "Distribution of predicted probability and predicted sigma", fig.width=6, fig.height=3.5----
par(mfrow = c(1, 2))
hist(predict(het_logit2, type = "pr"), 
     main = "Predicted probabilities", 
     xlab = "Probabilities")
hist(predict(het_logit2, type = "sigma"), 
     main = "Predicted sigma", 
     xlab = "Sigma")


## ----het.me-------------------------------------------------------------------
eff_logit  <- effect(het_logit2)
het_probit <- hetprob(tenure ~ factor(female) + year + I(year^2) + select +  
                        articles + prestige + factor(female)*articles | 
                        factor(female),              
                      data = sub_data,                        
                      link = "probit")
eff_probit <- effect(het_probit)
mtable(eff_probit,
       eff_logit)


## ----load-mroz----------------------------------------------------------------
mroz <- read.csv(file = 'mroz.csv')
mroz$kids <- with(mroz, factor((kidslt6 + kidsge6) > 0,
                               levels = c(FALSE, TRUE), 
                               labels = c("no", "yes")))
mroz$finc <-  mroz$faminc / 10000


## ----greene-17----------------------------------------------------------------
labor_hom <- glm(inlf ~  age + I(age^2) + finc + educ + factor(kids), 
                 data = mroz, 
                 family = binomial(link = "probit"))
labor_het <- hetprob(inlf ~  age + I(age^2) + finc + educ + factor(kids) | 
                       factor(kids) + finc,              
                     data = mroz,                        
                     link = "probit")
eff_labor_het <- effect(labor_het)
mtable(labor_hom,
       labor_het,
       eff_labor_het)


## ----test-homokedasticity-----------------------------------------------------
coefs <- names(coef(labor_het))
linearHypothesis(labor_het, coefs[grep("het", coefs)])


## ----probit-nwincome----------------------------------------------------------
probit <- glm(inlf ~  educ + exper + I(exper^2) + age + kidslt6 + kidsge6 + nwifeinc, 
              data = mroz, 
              family = binomial(link = "probit"))
ape.probit <- mean(dnorm(predict(probit, type = "link"))) * coef(probit)["nwifeinc"]
ape.probit


## ----margins------------------------------------------------------------------
library("marginaleffects")
avg_slopes(probit, variables = "nwifeinc")


## ----iv-first-step------------------------------------------------------------
fstep   <- lm(nwifeinc ~ educ + exper + I(exper^2) + age + kidslt6 + kidsge6  + huseduc, 
            data = mroz)
mroz$res.hat <- fstep$residuals


## ----F-test-------------------------------------------------------------------
linearHypothesis(fstep, "huseduc")


## ----iv-second-step-----------------------------------------------------------
sstep   <- glm(inlf ~  educ + exper + I(exper^2) + age + kidslt6 + kidsge6 + nwifeinc + res.hat, 
            data   = mroz, 
            family = binomial(link = "probit")) 
summary(sstep)


## ----compute-rho--------------------------------------------------------------
lambda.hat    <- coef(sstep)["res.hat"]
k             <- length(fstep$coefficients)
SSE           <- sum(fstep$residuals^2)
n             <- length(fstep$residuals)
sigma.upsilon <- sqrt(SSE/(n - k))
rho.hat       <- lambda.hat * sigma.upsilon
rho.hat


## ----ivprobit-function--------------------------------------------------------
library("ivprobit")
twostep.probit <- ivprobit(inlf ~  educ + exper + I(exper^2) + age + kidslt6 + kidsge6 | 
                             nwifeinc | educ + exper + I(exper^2) + age + kidslt6 + 
                             kidsge6 + huseduc, 
                           data = mroz)
summary(twostep.probit)


## ----ape----------------------------------------------------------------------
ape <- function(data, indices){
  d <- data[indices, ]
  # Compute the first-stage regression
  fstep    <- lm(nwifeinc ~ educ + exper + I(exper^2) + age + kidslt6 + kidsge6 + 
                   huseduc, 
                 data = d)
  # Obtain the residuals 
  d$res.hat <- fstep$residuals
  # Compute the second-stage regression
  sstep   <- glm(inlf ~  educ + exper + I(exper^2) + age + kidslt6 + kidsge6 + 
                   nwifeinc + res.hat, 
                 data   = d, 
                 family = binomial(link = "probit"))
  # Compute APE for nwincome
  out <- mean(dnorm(predict(sstep, type = "link"))) * coef(sstep)["nwifeinc"]
  return(out)
}


## ----boot, message = FALSE----------------------------------------------------
library("boot")
set.seed(666)
results <- boot(data = mroz, statistic = ape, R = 500)
results
boot.ci(results, type = "norm", conf = 0.90)


## ----unscaledpar--------------------------------------------------------------
coef(sstep) * sqrt(1 - rho.hat^2)


## ----fiml---------------------------------------------------------------------
fiml.probit <- ivpml(inlf ~  educ + exper + I(exper^2) + age + kidslt6 + kidsge6 + 
                       nwifeinc | huseduc +  educ + exper + I(exper^2) + age + 
                       kidslt6 + kidsge6, 
                     data = mroz)


## ----summary-ivpml------------------------------------------------------------
summary(fiml.probit)


## ----rho-sigma----------------------------------------------------------------
deltaMethod(fiml.probit, "exp(lnsigma)")
deltaMethod(fiml.probit, "tanh(atanhrho)")


## ----rho-sigma-stata----------------------------------------------------------
cbind(exp(coef(fiml.probit)["lnsigma"] - qnorm(0.975) * stdEr(fiml.probit)["lnsigma"]), 
      exp(coef(fiml.probit)["lnsigma"] + qnorm(0.975) * stdEr(fiml.probit)["lnsigma"]))
cbind(tanh(coef(fiml.probit)["atanhrho"] - qnorm(0.975) * stdEr(fiml.probit)["atanhrho"]), 
      tanh(coef(fiml.probit)["atanhrho"] + qnorm(0.975) * stdEr(fiml.probit)["atanhrho"]))


## ----effect.ivpml-------------------------------------------------------------
summary(effect(fiml.probit))
summary(effect(fiml.probit, asf = FALSE))


#>  *=========================================
#>  *** Example 1: Promotion of scientists ***
#>  *=========================================
#> . import delimited "$dir/tenure.csv", clear
#> (23 vars, 2,945 obs)
#> 
#> . ** Logit models for men and women
#> . quietly eststo logit_m: logit tenure year c.year#c.year select ///
#>                           articles prestige if (year <= 10 & female == 0)
#> 
#> . quietly eststo logit_w: logit tenure year c.year#c.year select ///
#>                           articles prestige if (year <= 10 & female == 1)
#> 
#> . esttab logit_m logit_w, b(3) se(3)
#> --------------------------------------------
#>                       (1)             (2)
#>                    tenure          tenure
#> --------------------------------------------
#> tenure
#> year                1.909***        1.408***
#>                   (0.214)         (0.257)
#> c.year#c.y~r       -0.143***       -0.096***
#>                   (0.019)         (0.022)
#> select              0.216***        0.055
#>                   (0.061)         (0.072)
#> articles            0.074***        0.034**
#>                   (0.012)         (0.013)
#> prestige           -0.431***       -0.371*
#>                   (0.109)         (0.156)
#> _cons              -7.680***       -5.842***
#>                   (0.681)         (0.866)
#> --------------------------------------------
#> N                    1741            1056
#> --------------------------------------------
#> Standard errors in parentheses
#> * p<0.05, ** p<0.01, *** p<0.001
#> 
#> . ** Heterokedastic logit model
#> . quietly ssc install oglm
#> 
#> . quietly eststo het_logit: oglm tenure i.female year c.year#c.year select ///
#>                            articles prestige if (year <= 10), hetero(i.female) link(logit)
#> 
#> . esttab logit_m logit_w het_logit, b(3) se(3)
#> ------------------------------------------------------------
#>                       (1)             (2)             (3)
#>                    tenure          tenure          tenure
#> ------------------------------------------------------------
#> tenure
#> year                1.909***        1.408***        1.910***
#>                   (0.214)         (0.257)         (0.200)
#> c.year#c.y~r       -0.143***       -0.096***       -0.140***
#>                   (0.019)         (0.022)         (0.017)
#> select              0.216***        0.055           0.182***
#>                   (0.061)         (0.072)         (0.053)
#> articles            0.074***        0.034**         0.064***
#>                   (0.012)         (0.013)         (0.010)
#> prestige           -0.431***       -0.371*         -0.446***
#>                   (0.109)         (0.156)         (0.097)
#> 0.female                                            0.000
#>                                                       (.)
#> 1.female                                           -0.939*
#>                                                   (0.371)
#> _cons              -7.680***       -5.842***
#>                   (0.681)         (0.866)
#> ------------------------------------------------------------
#> lnsigma
#> 0.female                                            0.000
#>                                                       (.)
#> 1.female                                            0.302*
#>                                                   (0.146)
#> ------------------------------------------------------------
#> cut1
#> _cons                                               7.491***
#>                                                   (0.660)
#> ------------------------------------------------------------
#> N                    1741            1056            2797
#> ------------------------------------------------------------
#> Standard errors in parentheses
#> * p<0.05, ** p<0.01, *** p<0.001
#> 
#> . ** Testing how much the disturbance standard deviation differ by gender
#> . margins, expression((1 - exp([lnsigma]_b[1.female])) / exp([lnsigma]_b[1.female]))
#> Warning: expression() does not contain predict() or xb().
#> Warning: prediction constant over observations.
#> 
#> Predictive margins                              Number of obs     =      2,797
#> Model VCE    : OIM
#> Expression   : (1 - exp([lnsigma]_b[1.female])) / exp([lnsigma]_b[1.female])
#> 
#> ------------------------------------------------------------------------------
#>              |            Delta-method
#>              |     Margin   Std. Err.      z    P>|z|     [95% Conf. Interval]
#> -------------+----------------------------------------------------------------
#>        _cons |  -.2608323   .1080501    -2.41   0.016    -.4726065   -.0490581
#> ------------------------------------------------------------------------------
#> 
#> . ** Heterokedastic logit model 2
#> . eststo het_logit2: oglm tenure i.female year c.year#c.year select ///
#>             articles prestige i.female#c.articles if (year <= 10), hetero(i.female) link(logit)
#> 
#> Heteroskedastic Ordered Logistic Regression     Number of obs     =      2,797
#>                                                 LR chi2(8)        =     415.39
#>                                                 Prob > chi2       =     0.0000
#> Log likelihood = -835.13347                     Pseudo R2         =     0.1992
#> 
#> -----------------------------------------------------------------------------------
#>            tenure |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
#> ------------------+----------------------------------------------------------------
#> tenure            |
#>          1.female |  -.3780598   .4500207    -0.84   0.401    -1.260084    .5039645
#>              year |   1.838257   .2029491     9.06   0.000     1.440484     2.23603
#>                   |
#>     c.year#c.year |  -.1342828    .017024    -7.89   0.000    -.1676492   -.1009165
#>                   |
#>            select |   .1699659   .0516643     3.29   0.001     .0687057    .2712261
#>          articles |   .0719821   .0114106     6.31   0.000     .0496178    .0943464
#>          prestige |  -.4204742   .0961206    -4.37   0.000     -.608867   -.2320813
#>                   |
#> female#c.articles |
#>                1  |  -.0304836   .0187427    -1.63   0.104    -.0672185    .0062514
#> ------------------+----------------------------------------------------------------
#> lnsigma           |
#>          1.female |   .1774193   .1627087     1.09   0.276    -.1414839    .4963226
#> ------------------+----------------------------------------------------------------
#>             /cut1 |   7.365286   .6547121    11.25   0.000     6.082074    8.648498
#> -----------------------------------------------------------------------------------
#> 
#> . ** Plot predicted probability and sigma
#> . predict phat, pr outcome(1)
#> . predict sigmahat, sigma
#> 
#> . hist phat
#> (bin=34, start=2.232e-12, width=.02503351)
#> 
#> . hist sigmahat
#> (bin=34, start=1, width=.00570976)
#> 
#> . ** Average Marginal Effects for logit and probit heterokedastic models
#> . quietly oglm tenure i.female year c.year#c.year select ///
#>                 articles prestige i.female#c.articles if (year <= 10), hetero(i.female) link(probit)
#> 
#> . eststo eff_probit: margins, dydx(*) predict(outcome(1)) post
#> Average marginal effects                        Number of obs     =      2,797
#> Model VCE    : OIM
#> Expression   : Pr(tenure==1), predict(outcome(1))
#> dy/dx w.r.t. : 1.female year select articles prestige
#> ------------------------------------------------------------------------------
#>              |            Delta-method
#>              |      dy/dx   Std. Err.      z    P>|z|     [95% Conf. Interval]
#> -------------+----------------------------------------------------------------
#>     1.female |   -.031161   .0115614    -2.70   0.007     -.053821   -.0085011
#>         year |    .031839   .0019586    16.26   0.000     .0280002    .0356779
#>       select |   .0142546   .0041796     3.41   0.001     .0060626    .0224465
#>     articles |     .00559   .0007685     7.27   0.000     .0040838    .0070962
#>     prestige |  -.0350608   .0077056    -4.55   0.000    -.0501635   -.0199581
#> ------------------------------------------------------------------------------
#> Note: dy/dx for factor levels is the discrete change from the base level.
#> 
#> . quietly oglm tenure i.female year c.year#c.year select ///
#>           articles prestige i.female#c.articles if (year <= 10), hetero(i.female) link(logit)
#> 
#> . eststo eff_logit: margins, dydx(*) predict(outcome(1)) post
#> Average marginal effects                        Number of obs     =      2,797
#> Model VCE    : OIM
#> Expression   : Pr(tenure==1), predict(outcome(1))
#> dy/dx w.r.t. : 1.female year select articles prestige
#> ------------------------------------------------------------------------------
#>              |            Delta-method
#>              |      dy/dx   Std. Err.      z    P>|z|     [95% Conf. Interval]
#> -------------+----------------------------------------------------------------
#>     1.female |  -.0312105   .0115836    -2.69   0.007     -.053914    -.008507
#>         year |   .0319057   .0019277    16.55   0.000     .0281275    .0356839
#>       select |   .0145808   .0042388     3.44   0.001      .006273    .0228886
#>     articles |   .0053378   .0007523     7.09   0.000     .0038632    .0068123
#>     prestige |  -.0360711    .007934    -4.55   0.000    -.0516215   -.0205207
#> ------------------------------------------------------------------------------
#> Note: dy/dx for factor levels is the discrete change from the base level.
#> 
#> . esttab eff_probit eff_logit, b(3) se(3)
#> --------------------------------------------
#>                       (1)             (2)
#> 
#> --------------------------------------------
#> 0.female            0.000           0.000
#>                       (.)             (.)
#> 1.female           -0.031**        -0.031**
#>                   (0.012)         (0.012)
#> year                0.032***        0.032***
#>                   (0.002)         (0.002)
#> select              0.014***        0.015***
#>                   (0.004)         (0.004)
#> articles            0.006***        0.005***
#>                   (0.001)         (0.001)
#> prestige           -0.035***       -0.036***
#>                   (0.008)         (0.008)
#> --------------------------------------------
#> N                    2797            2797
#> --------------------------------------------
#> Standard errors in parentheses
#> * p<0.05, ** p<0.01, *** p<0.001
#> 
#> . *=========================================
#> . *** Example 2: Labor Participation ***
#> . *=========================================
#> .
#> . * Open dataset and create variables
#> . import delimited "$dir/mroz.csv", clear
#> . gen kids = (kidslt6 + kidsge6) > 0
#> . gen finc = faminc/10000
#> 
#> . * Hetekedastic binary probit model
#> . quietly eststo labor_hom: probit inlf age c.age#c.age finc educ kids
#> . quietly eststo labor_het: oglm inlf age c.age#c.age finc educ i.kids, ///
#>                             hetero(finc i.kids) link(probit)
#> . quietly eststo eff_labor_het: margins, dydx(*) predict(outcome(1)) post
#> . esttab labor_hom labor_het eff_labor_het, b(3) se(3)
#> 
#> ------------------------------------------------------------
#>                       (1)             (2)             (3)
#>                      inlf            inlf
#> ------------------------------------------------------------
#> main
#> age                 0.185**         0.264*         -0.009***
#>                   (0.066)         (0.118)         (0.003)
#> c.age#c.age        -0.002**        -0.004*
#>                   (0.001)         (0.001)
#> finc                0.046           0.424           0.069**
#>                   (0.042)         (0.222)         (0.024)
#> educ                0.098***        0.140**         0.030***
#>                   (0.023)         (0.052)         (0.009)
#> kids               -0.449***
#>                   (0.131)
#> 0.kids                              0.000           0.000
#>                                       (.)             (.)
#> 1.kids                             -0.879**        -0.161***
#>                                   (0.303)         (0.043)
#> _cons              -4.157**
#>                   (1.402)
#> ------------------------------------------------------------
#> lnsigma
#> finc                                0.313*
#>                                   (0.123)
#> 0.kids                              0.000
#>                                       (.)
#> 1.kids                             -0.141
#>                                   (0.324)
#> ------------------------------------------------------------
#> cut1
#> _cons                               6.030*
#>                                   (2.498)
#> ------------------------------------------------------------
#> N                     753             753             753
#> ------------------------------------------------------------
#> Standard errors in parentheses
#> * p<0.05, ** p<0.01, *** p<0.001
#> 
#> . * Wald test
#> . estimates restore labor_het
#> (results labor_het are active now)
#> 
#> . quietly oglm
#> . test [lnsigma]: finc 1.kids
#> 
#>  ( 1)  [lnsigma]finc = 0
#>  ( 2)  [lnsigma]1.kids = 0
#> 
#>            chi2(  2) =    6.53
#>          Prob > chi2 =    0.0381
#> 

#> . ************************************
#> . *** IV Probit ***
#> . ************************************
#> 
#> . *=========================================
#> . *** Control function approach ***
#> . *=========================================
#> 
#> . import delimited "$dir/mroz.csv", clear
#> (22 vars, 753 obs)
#> 
#> . * Probit estimates and marginal effect
#> . probit inlf educ exper c.exper#c.exper age kidslt6 kidsge6 nwifeinc
#> 
#> Iteration 0:   log likelihood =  -514.8732
#> Iteration 1:   log likelihood = -402.06651
#> Iteration 2:   log likelihood = -401.30273
#> Iteration 3:   log likelihood = -401.30219
#> Iteration 4:   log likelihood = -401.30219
#> 
#> Probit regression                               Number of obs     =        753
#>                                                 LR chi2(7)        =     227.14
#>                                                 Prob > chi2       =     0.0000
#> Log likelihood = -401.30219                     Pseudo R2         =     0.2206
#> ---------------------------------------------------------------------------------
#>            inlf |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
#> ----------------+----------------------------------------------------------------
#>            educ |   .1309047   .0252542     5.18   0.000     .0814074     .180402
#>           exper |   .1233476   .0187164     6.59   0.000     .0866641    .1600311
#>                 |
#> c.exper#c.exper |  -.0018871      .0006    -3.15   0.002     -.003063   -.0007111
#>                 |
#>             age |  -.0528527   .0084772    -6.23   0.000    -.0694678   -.0362376
#>         kidslt6 |  -.8683285   .1185223    -7.33   0.000    -1.100628    -.636029
#>         kidsge6 |    .036005   .0434768     0.83   0.408     -.049208    .1212179
#>        nwifeinc |  -.0120237   .0048398    -2.48   0.013    -.0215096   -.0025378
#>           _cons |   .2700768    .508593     0.53   0.595    -.7267473    1.266901
#> ---------------------------------------------------------------------------------
#> 
#> . margins, dydx(nwifeinc)
#> Average marginal effects                        Number of obs     =        753
#> Model VCE    : OIM
#> Expression   : Pr(inlf), predict()
#> dy/dx w.r.t. : nwifeinc
#> 
#> ------------------------------------------------------------------------------
#>              |            Delta-method
#>              |      dy/dx   Std. Err.      z    P>|z|     [95% Conf. Interval]
#> -------------+----------------------------------------------------------------
#>     nwifeinc |  -.0036162   .0014414    -2.51   0.012    -.0064413   -.0007911
#> ------------------------------------------------------------------------------
#> 
#> . * Control function approach
#> . eststo fstep: reg nwifeinc educ exper c.exper#c.exper age kidslt6 kidsge6 huseduc
#> 
#>       Source |       SS           df       MS      Number of obs   =       753
#> -------------+----------------------------------   F(7, 745)       =     27.13
#>        Model |  20676.7705         7  2953.82436   Prob > F        =    0.0000
#>     Residual |  81120.3451       745  108.886369   R-squared       =    0.2031
#> -------------+----------------------------------   Adj R-squared   =    0.1956
#>        Total |  101797.116       752  135.368505   Root MSE        =    10.435
#> ---------------------------------------------------------------------------------
#>        nwifeinc |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
#> ----------------+----------------------------------------------------------------
#>            educ |   .6746951   .2136829     3.16   0.002     .2552029    1.094187
#>           exper |  -.3129877   .1382549    -2.26   0.024    -.5844034   -.0415721
#>                 |
#> c.exper#c.exper |  -.0004776   .0045196    -0.11   0.916    -.0093501     .008395
#>                 |
#>             age |   .3401521   .0597084     5.70   0.000     .2229354    .4573687
#>         kidslt6 |   .8262719   .8183785     1.01   0.313    -.7803305    2.432874
#>         kidsge6 |   .4355289   .3219888     1.35   0.177    -.1965845    1.067642
#>         huseduc |   1.178155   .1609449     7.32   0.000     .8621956    1.494115
#>           _cons |  -14.72048   3.787326    -3.89   0.000    -22.15559   -7.285383
#> ---------------------------------------------------------------------------------
#> 
#> . predict res_hat, resi
#> 
#> . test huseduc
#>  ( 1)  huseduc = 0
#>        F(  1,   745) =   53.59
#>             Prob > F =    0.0000
#> 
#> . eststo sstep: probit inlf educ exper c.exper#c.exper age kidslt6 kidsge6 nwifeinc res_hat
#> 
#> Iteration 0:   log likelihood =  -514.8732
#> Iteration 1:   log likelihood = -401.13728
#> Iteration 2:   log likelihood = -400.30361
#> Iteration 3:   log likelihood = -400.30301
#> Iteration 4:   log likelihood = -400.30301
#> 
#> Probit regression                               Number of obs     =        753
#>                                                 LR chi2(8)        =     229.14
#>                                                 Prob > chi2       =     0.0000
#> Log likelihood = -400.30301                     Pseudo R2         =     0.2225
#> ---------------------------------------------------------------------------------
#>            inlf |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
#> ----------------+----------------------------------------------------------------
#>            educ |   .1702153   .0376718     4.52   0.000     .0963798    .2440507
#>           exper |   .1163123   .0193312     6.02   0.000     .0784239    .1542007
#>                 |
#> c.exper#c.exper |  -.0019459   .0006009    -3.24   0.001    -.0031235   -.0007682
#>                 |
#>             age |   -.044953   .0101367    -4.43   0.000    -.0648206   -.0250855
#>         kidslt6 |  -.8444363   .1198154    -7.05   0.000     -1.07927   -.6096025
#>         kidsge6 |   .0477905   .0443204     1.08   0.281    -.0390758    .1346568
#>        nwifeinc |  -.0368641   .0182706    -2.02   0.044    -.0726738   -.0010543
#>         res_hat |   .0267093   .0189352     1.41   0.158    -.0104031    .0638217
#>           _cons |   .0171187   .5392914     0.03   0.975    -1.039873     1.07411
#> ---------------------------------------------------------------------------------
#> 
#> . * Two-step IV-probit
#> . ivprobit inlf educ exper c.exper#c.exper age kidslt6 kidsge6 (nwifeinc = huseduc), twostep
#> Checking reduced-form model...
#> 
#> Two-step probit with endogenous regressors        Number of obs   =        753
#>                                                   Wald chi2(7)    =     173.79
#>                                                   Prob > chi2     =     0.0000
#> ---------------------------------------------------------------------------------
#>                 |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
#> ----------------+----------------------------------------------------------------
#>        nwifeinc |  -.0368641   .0186314    -1.98   0.048    -.0733809   -.0003472
#>            educ |   .1702153   .0384014     4.43   0.000     .0949499    .2454806
#>           exper |   .1163123   .0197084     5.90   0.000     .0776846      .15494
#>                 |
#> c.exper#c.exper |  -.0019459   .0006129    -3.17   0.001    -.0031471   -.0007446
#>                 |
#>             age |   -.044953    .010327    -4.35   0.000    -.0651936   -.0247125
#>         kidslt6 |  -.8444363   .1218529    -6.93   0.000    -1.083264    -.605609
#>         kidsge6 |   .0477905    .045177     1.06   0.290    -.0407549    .1363359
#>           _cons |   .0171187   .5498911     0.03   0.975    -1.060648    1.094885
#> ---------------------------------------------------------------------------------
#> Instrumented:  nwifeinc
#> Instruments:   educ exper c.exper#c.exper age kidslt6 kidsge6 huseduc
#> ---------------------------------------------------------------------------------
#> Wald test of exogeneity: chi2(1) = 1.99                   Prob > chi2 = 0.1584
#> 
#> 
#> . *=========================================
#> . *** MLE ***
#> . *=========================================
#> 
#> . ivprobit inlf educ exper c.exper#c.exper age kidslt6 kidsge6 (nwifeinc = huseduc)
#> 
#> Fitting exogenous probit model
#> 
#> Iteration 0:   log likelihood =  -514.8732
#> Iteration 1:   log likelihood = -401.13728
#> Iteration 2:   log likelihood = -400.30361
#> Iteration 3:   log likelihood = -400.30301
#> Iteration 4:   log likelihood = -400.30301
#> 
#> Fitting full model
#> 
#> Iteration 0:   log likelihood = -3230.6635
#> Iteration 1:   log likelihood = -3230.6421
#> Iteration 2:   log likelihood = -3230.6421
#> 
#> Probit model with endogenous regressors         Number of obs     =        753
#>                                                 Wald chi2(7)      =     200.50
#> Log likelihood = -3230.6421                     Prob > chi2       =     0.0000
#> -----------------------------------------------------------------------------------------
#>                         |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
#> ------------------------+----------------------------------------------------------------
#>                nwifeinc |  -.0355243   .0161904    -2.19   0.028    -.0672569   -.0037916
#>                    educ |   .1640289   .0312249     5.25   0.000     .1028293    .2252285
#>                   exper |    .112085   .0211991     5.29   0.000     .0705356    .1536344
#>                         |
#>         c.exper#c.exper |  -.0018751   .0005915    -3.17   0.002    -.0030345   -.0007158
#>                         |
#>                     age |  -.0433193   .0113314    -3.82   0.000    -.0655284   -.0211101
#>                 kidslt6 |  -.8137458   .1299442    -6.26   0.000    -1.068432   -.5590599
#>                 kidsge6 |   .0460536   .0431386     1.07   0.286    -.0384966    .1306037
#>                   _cons |   .0164965   .5300821     0.03   0.975    -1.022445    1.055438
#> ------------------------+----------------------------------------------------------------
#>  corr(e.nwifeinc,e.inlf)|   .2671475   .1791903                     -.1040303    .5730063
#>           sd(e.nwifeinc)|   10.37928   .2674576                      9.868095    10.91695
#> -----------------------------------------------------------------------------------------
#> Instrumented:  nwifeinc
#> Instruments:   educ exper c.exper#c.exper age kidslt6 kidsge6 huseduc
#> -----------------------------------------------------------------------------------------
#> Wald test of exogeneity (corr = 0): chi2(1) = 2.01        Prob > chi2 = 0.1559
#> 
#> . eststo me1: margins, dydx(*) predict(pr) post
#> Average marginal effects                        Number of obs     =        753
#> Model VCE    : OIM
#> Expression   : Average structural function probabilities, predict(pr)
#> dy/dx w.r.t. : nwifeinc educ exper age kidslt6 kidsge6
#> ------------------------------------------------------------------------------
#>              |            Delta-method
#>              |      dy/dx   Std. Err.      z    P>|z|     [95% Conf. Interval]
#> -------------+----------------------------------------------------------------
#>     nwifeinc |  -.0110576   .0055497    -1.99   0.046    -.0219348   -.0001805
#>         educ |   .0510572   .0111011     4.60   0.000     .0292994     .072815
#>        exper |   .0230711   .0029517     7.82   0.000     .0172858    .0288563
#>          age |   -.013484    .002986    -4.52   0.000    -.0193365   -.0076314
#>      kidslt6 |  -.2532945   .0330766    -7.66   0.000    -.3181235   -.1884655
#>      kidsge6 |   .0143351   .0135204     1.06   0.289    -.0121644    .0408345
#> ------------------------------------------------------------------------------
#> 
#> . qui ivprobit inlf educ exper c.exper#c.exper age kidslt6 kidsge6 (nwifeinc = huseduc)
#> . eststo me2: margins, dydx(*) predict(pr fix(nwifeinc)) post
#> 
#> Average marginal effects                        Number of obs     =        753
#> Model VCE    : OIM
#> 
#> Expression   : Average structural function probabilities, predict(pr fix(nwifeinc))
#> dy/dx w.r.t. : nwifeinc educ exper age kidslt6 kidsge6
#> ------------------------------------------------------------------------------
#>              |            Delta-method
#>              |      dy/dx   Std. Err.      z    P>|z|     [95% Conf. Interval]
#> -------------+----------------------------------------------------------------
#>     nwifeinc |  -.0105638   .0047364    -2.23   0.026    -.0198469   -.0012807
#>         educ |   .0487769   .0087333     5.59   0.000       .03166    .0658937
#>        exper |   .0219965   .0037232     5.91   0.000     .0146992    .0292939
#>          age |  -.0128817   .0033216    -3.88   0.000     -.019392   -.0063714
#>      kidslt6 |  -.2419815   .0365941    -6.61   0.000    -.3137047   -.1702583
#>      kidsge6 |   .0136948   .0127924     1.07   0.284    -.0113777    .0387674
#> ------------------------------------------------------------------------------
#> Warning: The chosen prediction can result in estimates of derivatives or
#>          contrasts that do not have a structural function interpretation.
#> 
#> . esttab  me1 me2, b(3) se(3)
#> --------------------------------------------
#>                       (1)             (2)
#> 
#> --------------------------------------------
#> nwifeinc           -0.011*         -0.011*
#>                   (0.006)         (0.005)
#> educ                0.051***        0.049***
#>                   (0.011)         (0.009)
#> exper               0.023***        0.022***
#>                   (0.003)         (0.004)
#> age                -0.013***       -0.013***
#>                   (0.003)         (0.003)
#> kidslt6            -0.253***       -0.242***
#>                   (0.033)         (0.037)
#> kidsge6             0.014           0.014
#>                   (0.014)         (0.013)
#> --------------------------------------------
#> N                     753             753
#> --------------------------------------------
#> Standard errors in parentheses
#> * p<0.05, ** p<0.01, *** p<0.001
